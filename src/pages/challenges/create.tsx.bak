import { Create, useForm } from "@refinedev/antd";
import { useCreate, useList } from "@refinedev/core";
import { Form, Input, DatePicker, InputNumber, Radio, Card, Divider, Alert, Switch, message, Select } from "antd";
import { useState, useEffect } from "react";

const { RangePicker } = DatePicker;
const { TextArea } = Input;

export const ChallengeCreate = () => {
  const [challengeType, setChallengeType] = useState<string>("lifemastery");
  const [guilds, setGuilds] = useState<any[]>([]);
  const [categories, setCategories] = useState<any[]>([]);
  const [selectedGuildId, setSelectedGuildId] = useState<string>("");
  const [challengeCategories, setChallengeCategories] = useState<any[]>([]);

  const { mutate: createChallenge } = useCreate();
  const { mutate: createPolicy } = useCreate();

  const { formProps, saveButtonProps, form } = useForm({
    redirect: false, // ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¹„í™œì„±í™”
  });

  // challenge_categories í…Œì´ë¸” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const { data: challengeCategoriesData } = useList({
    resource: "challenge_categories",
    pagination: {
      mode: "off",
    },
  });

  useEffect(() => {
    if (challengeCategoriesData?.data) {
      setChallengeCategories(challengeCategoriesData.data);
    }
  }, [challengeCategoriesData]);

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ê¸¸ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  useEffect(() => {
    fetchGuilds();
  }, []);

  // ê¸¸ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const fetchGuilds = async () => {
    try {
      const response = await fetch("http://146.56.158.19/api/admin/discord/guilds");
      const result = await response.json();
      if (result.success) {
        setGuilds(result.data);
      }
    } catch (error) {
      console.error("ê¸¸ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
    }
  };

  // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const fetchCategories = async (guildId: string) => {
    try {
      const response = await fetch(`http://146.56.158.19/api/admin/discord/guilds/${guildId}/categories`);
      const result = await response.json();
      if (result.success) {
        setCategories(result.data);
      }
    } catch (error) {
      console.error("ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
    }
  };

  // ê¸¸ë“œ ì„ íƒ ì‹œ
  const handleGuildChange = (guildId: string) => {
    setSelectedGuildId(guildId);
    fetchCategories(guildId);
    form.setFieldsValue({ category_id: undefined });
  };

  // Form ì œì¶œ ì‹œ ë°ì´í„° ë³€í™˜
  const handleFinish = (values: any) => {
    try {
      console.log("ğŸ“ Form ì œì¶œ ì‹œì‘:", values);

      // periodê°€ ì—†ìœ¼ë©´ ì—ëŸ¬
      if (!values.period || !values.period[0] || !values.period[1]) {
        message.error("ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      // ì •ì±… í•„ë“œë“¤ ë¶„ë¦¬ (í•­ìƒ ìƒì„±)
      const policyFields = {
        morning_normal_start: values.morning_normal_start || "05:00",
        morning_normal_end: values.morning_normal_end || "10:00",
        morning_late_end: values.morning_late_end || "11:00",
        daily_normal_start: values.daily_normal_start || "17:00",
        daily_normal_end: values.daily_normal_end || "23:59",
        daily_late_end: values.daily_late_end || "01:00",
        min_weekly_count: values.min_weekly_count || 4,
        revival_min_morning_count: values.revival_min_morning_count || 3,
        revival_min_daily_count: values.revival_min_daily_count || 3,
        rest_period_weeks: values.rest_period_weeks || 2,
        daily_goal_minutes: values.daily_goal_minutes || 20,
        min_meditation_minutes: values.min_meditation_minutes || 5,
        start_message: values.start_message || "ëª…ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ§˜â€â™€ï¸",
        end_message: values.end_message || "ëª…ìƒì„ ì¢…ë£Œí•©ë‹ˆë‹¤ âœ¨ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!",
        declaration_deadline_day: values.declaration_deadline_day || "sun",
        declaration_deadline_time: values.declaration_deadline_time !== undefined ? values.declaration_deadline_time : 23,
        declaration_required: values.declaration_required !== undefined ? values.declaration_required : true,
      };

      // undefined/null ê°’ ì œê±°
      const cleanedPolicyFields = Object.fromEntries(
        Object.entries(policyFields).filter(([_, v]) => v !== undefined && v !== null && v !== "")
      );

      // ì±Œë¦°ì§€ ë°ì´í„° ìƒì„± - í•„ìˆ˜ í•„ë“œ
      const challengeValues: any = {
        name: values.name,
        type: values.type,
        start_date: values.period[0].toISOString(),
        end_date: values.period[1].toISOString(),
        is_active: values.is_active !== undefined ? values.is_active : true,
        demotion_enabled: values.demotion_enabled !== undefined ? values.demotion_enabled : false,
      };

      // ì„ íƒ í•„ë“œ ì¶”ê°€ (ê°’ì´ ìˆì„ ë•Œë§Œ)
      console.log("ğŸ”¢ cardinal_number ê°’:", values.cardinal_number, "íƒ€ì…:", typeof values.cardinal_number);
      // cardinal_numberëŠ” 0ë„ ìœ íš¨í•œ ê°’ì´ë¯€ë¡œ ìˆ«ì íƒ€ì…ì¼ ë•Œ ì €ì¥
      if (typeof values.cardinal_number === 'number' || (values.cardinal_number !== undefined && values.cardinal_number !== null && values.cardinal_number !== "")) {
        challengeValues.cardinal_number = Number(values.cardinal_number);
        console.log("âœ… cardinal_number ì €ì¥ë¨:", challengeValues.cardinal_number);
      } else {
        console.log("âš ï¸ cardinal_numberê°€ ë¹„ì–´ìˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŒ");
      }
      if (values.description) {
        challengeValues.description = values.description;
      }
      // ì±Œë¦°ì§€ ì¹´í…Œê³ ë¦¬ ID ì €ì¥ (challenge_categories í…Œì´ë¸” ë ˆì½”ë“œ ID)
      if (values.category_id) {
        challengeValues.category_id = values.category_id;
        console.log("âœ… category_id ì €ì¥ë¨:", challengeValues.category_id);
      }
      // Discord ì¹´í…Œê³ ë¦¬ ID ì €ì¥ (ì„ íƒì‚¬í•­)
      if (values.discord_category_id) {
        challengeValues.discord_category_id = values.discord_category_id;
        console.log("âœ… discord_category_id ì €ì¥ë¨:", challengeValues.discord_category_id);
      }
      if (values.channel_id) {
        challengeValues.channel_id = values.channel_id;
      }
      if (values.role_id) {
        challengeValues.role_id = values.role_id;
      }

      const cleanedChallengeValues = challengeValues;

      console.log("ğŸ”„ ì±Œë¦°ì§€ ë°ì´í„°:", cleanedChallengeValues);
      console.log("ğŸ”„ ì •ì±… ë°ì´í„°:", cleanedPolicyFields);

      // 1. ë¨¼ì € ì •ì±… ìƒì„± (ë¬´ì¡°ê±´ ìƒì„±)
      console.log("ğŸ“ ì •ì±… ë°ì´í„° ìƒì„± ì‹œì‘:", cleanedPolicyFields);

      createPolicy(
        {
          resource: "challenge_policies",
          values: cleanedPolicyFields,
        },
        {
          onSuccess: (policyData: any) => {
            console.log("âœ… ì •ì±… ìƒì„± ì„±ê³µ:", policyData);
            const policyId = policyData?.data?.id;

            if (!policyId) {
              message.error("ì •ì±… IDë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
              return;
            }

            // 2. ì •ì±… ìƒì„± ì„±ê³µ í›„, policy_idë¥¼ í¬í•¨í•´ì„œ ì±Œë¦°ì§€ ìƒì„±
            const challengeValuesWithPolicy = {
              ...cleanedChallengeValues,
              policy_id: policyId,
            };

            console.log("ğŸ“ ì±Œë¦°ì§€ ë°ì´í„° ìƒì„± ì‹œì‘ (policy_id í¬í•¨):", challengeValuesWithPolicy);

            createChallenge(
              {
                resource: "challenges",
                values: challengeValuesWithPolicy,
              },
              {
                onSuccess: (challengeData: any) => {
                  console.log("âœ… ì±Œë¦°ì§€ ìƒì„± ì„±ê³µ:", challengeData);
                  message.success("ì±Œë¦°ì§€ì™€ ì •ì±…ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
                  // ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
                  window.location.href = "/challenges";
                },
                onError: (error: any) => {
                  console.error("âŒ ì±Œë¦°ì§€ ìƒì„± ì‹¤íŒ¨:", error);
                  console.error("âŒ ì—ëŸ¬ ì „ì²´ ê°ì²´:", JSON.stringify(error, null, 2));
                  console.error("âŒ ì—ëŸ¬ ì‘ë‹µ ë°ì´í„°:", error?.response);
                  console.error("âŒ ì—ëŸ¬ ë°ì´í„°:", error?.data);

                  // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ì¶œ
                  let errorMessage = "ì±Œë¦°ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";

                  // PocketBase ì—ëŸ¬ í˜•ì‹ ì²˜ë¦¬
                  if (error?.data) {
                    const errorData = error.data;
                    if (errorData.data) {
                      // í•„ë“œë³„ ì—ëŸ¬ ë©”ì‹œì§€ ì¡°í•©
                      const fieldErrors = Object.entries(errorData.data).map(([field, err]: [string, any]) => {
                        return `${field}: ${err.message || err.code}`;
                      }).join('\n');
                      errorMessage = `ê²€ì¦ ì˜¤ë¥˜:\n${fieldErrors}`;
                    } else if (errorData.message) {
                      errorMessage = errorData.message;
                    }
                  } else if (error?.response?.data?.message) {
                    errorMessage = error.response.data.message;
                  } else if (error?.message) {
                    errorMessage = error.message;
                  } else if (typeof error === 'string') {
                    errorMessage = error;
                  }

                  message.error(errorMessage, 10);
                  console.error("ğŸ“‹ ì „ì†¡í•œ ë°ì´í„°:", challengeValuesWithPolicy);
                },
              }
            );
          },
          onError: (error: any) => {
            console.error("âŒ ì •ì±… ìƒì„± ì‹¤íŒ¨:", error);
            console.error("âŒ ì—ëŸ¬ ì „ì²´ ê°ì²´:", JSON.stringify(error, null, 2));

            let errorMessage = "ì •ì±… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
            if (error?.data?.message) {
              errorMessage = error.data.message;
            } else if (error?.message) {
              errorMessage = error.message;
            }

            message.error(errorMessage, 10);
            console.error("ğŸ“‹ ì „ì†¡í•œ ì •ì±… ë°ì´í„°:", cleanedPolicyFields);
          },
        }
      );
    } catch (error: any) => {
      console.error("âŒ Form ì œì¶œ ì¤‘ ì˜¤ë¥˜:", error);
      message.error(`Form ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
    }
  };

  return (
    <Create saveButtonProps={saveButtonProps}>
      <Form
        {...formProps}
        onFinish={handleFinish}
        layout="vertical"
        initialValues={{
          type: "lifemastery",
          is_active: true,
          demotion_enabled: false,
          morning_normal_start: "05:00",
          morning_normal_end: "10:00",
          morning_late_end: "11:00",
          daily_normal_start: "17:00",
          daily_normal_end: "23:59",
          daily_late_end: "01:00",
          min_weekly_count: 4,
          revival_min_morning_count: 3,
          revival_min_daily_count: 3,
          rest_period_weeks: 2,
          daily_goal_minutes: 20,
          min_meditation_minutes: 5,
          start_message: "ëª…ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ§˜â€â™€ï¸",
          end_message: "ëª…ìƒì„ ì¢…ë£Œí•©ë‹ˆë‹¤ âœ¨ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!",
          declaration_deadline_day: "sun",
          declaration_deadline_time: 23,
          declaration_required: true
        }}
      >
          onError: (error: any) => {
            console.error("âŒ ì±Œë¦°ì§€ ìƒì„± ì‹¤íŒ¨:", error);
            console.error("âŒ ì—ëŸ¬ ì „ì²´ ê°ì²´:", JSON.stringify(error, null, 2));
            console.error("âŒ ì—ëŸ¬ ì‘ë‹µ ë°ì´í„°:", error?.response);
            console.error("âŒ ì—ëŸ¬ ë°ì´í„°:", error?.data);

            // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ì¶œ
            let errorMessage = "ì±Œë¦°ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";

            // PocketBase ì—ëŸ¬ í˜•ì‹ ì²˜ë¦¬
            if (error?.data) {
              const errorData = error.data;
              if (errorData.data) {
                // í•„ë“œë³„ ì—ëŸ¬ ë©”ì‹œì§€ ì¡°í•©
                const fieldErrors = Object.entries(errorData.data).map(([field, err]: [string, any]) => {
                  return `${field}: ${err.message || err.code}`;
                }).join('\n');
                errorMessage = `ê²€ì¦ ì˜¤ë¥˜:\n${fieldErrors}`;
              } else if (errorData.message) {
                errorMessage = errorData.message;
              }
            } else if (error?.response?.data?.message) {
              errorMessage = error.response.data.message;
            } else if (error?.message) {
              errorMessage = error.message;
            } else if (typeof error === 'string') {
              errorMessage = error;
            }

            message.error(errorMessage, 10);
            console.error("ğŸ“‹ ì „ì†¡í•œ ë°ì´í„°:", cleanedChallengeValues);
          },
        }
      );
    } catch (error: any) {
      console.error("âŒ Form ì œì¶œ ì¤‘ ì˜¤ë¥˜:", error);
      message.error(`Form ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
    }
  };

  return (
    <Create saveButtonProps={saveButtonProps}>
      <Form
        {...formProps}
        onFinish={handleFinish}
        layout="vertical"
        initialValues={{
          type: "lifemastery",
          is_active: true,
          demotion_enabled: false,
          morning_normal_start: "05:00",
          morning_normal_end: "10:00",
          morning_late_end: "11:00",
          daily_normal_start: "17:00",
          daily_normal_end: "23:59",
          daily_late_end: "01:00",
          min_weekly_count: 4,
          revival_min_morning_count: 3,
          revival_min_daily_count: 3,
          rest_period_weeks: 2,
          daily_goal_minutes: 20,
          min_meditation_minutes: 5,
          start_message: "ëª…ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ§˜â€â™€ï¸",
          end_message: "ëª…ìƒì„ ì¢…ë£Œí•©ë‹ˆë‹¤ âœ¨ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!",
          declaration_deadline_day: "sun",
          declaration_deadline_time: 23,
          declaration_required: true
        }}
      >
        {/* ì±Œë¦°ì§€ íƒ€ì… ì„ íƒ */}
        <Card title="ì±Œë¦°ì§€ íƒ€ì… ì„ íƒ" style={{ marginBottom: 24 }}>
          <Form.Item
            name="type"
            rules={[{ required: true, message: "ì±Œë¦°ì§€ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”" }]}
          >
            <Radio.Group
              onChange={(e) => setChallengeType(e.target.value)}
              defaultValue="lifemastery"
            >
              <Radio.Button value="lifemastery" style={{ marginRight: 16 }}>
                ğŸ† ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬
              </Radio.Button>
              <Radio.Button value="lifemastery-club" style={{ marginRight: 16 }}>
                ğŸ¯ ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬ í´ëŸ½
              </Radio.Button>
              <Radio.Button value="meditation" style={{ marginRight: 16 }}>
                ğŸ§˜ ëª…ìƒ ë°”ë””ë”ë¸”ë§
              </Radio.Button>
              <Radio.Button value="weekly-planning">
                ğŸ“… ìœ„í´ë¦¬ í”Œë˜ë‹
              </Radio.Button>
            </Radio.Group>
          </Form.Item>

          {challengeType === "lifemastery" && (
            <Alert
              message="ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬ ì±Œë¦°ì§€"
              description="ì•„ì¹¨/ë°ì¼ë¦¬ ì¸ì¦ì„ í†µí•´ ë£¨í‹´ì„ ë§Œë“œëŠ” ì±Œë¦°ì§€ì…ë‹ˆë‹¤. #ì¸ì¦ íƒœê·¸ë¡œ ì¸ì¦í•©ë‹ˆë‹¤."
              type="info"
              showIcon
              style={{ marginTop: 16 }}
            />
          )}

          {challengeType === "lifemastery-club" && (
            <Alert
              message="ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬ í´ëŸ½"
              description="ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬ í´ëŸ½ ì „ìš© ì±Œë¦°ì§€ì…ë‹ˆë‹¤. ê¸°ìˆ˜ë³„ë¡œ ê´€ë¦¬ë˜ë©°, íŒ€ ë‹¨ìœ„ë¡œ ìš´ì˜ë©ë‹ˆë‹¤."
              type="info"
              showIcon
              style={{ marginTop: 16 }}
            />
          )}

          {challengeType === "meditation" && (
            <Alert
              message="ëª…ìƒ ë°”ë””ë”ë¸”ë§ ì±Œë¦°ì§€"
              description="#ì‹œì‘ìœ¼ë¡œ ëª…ìƒì„ ì‹œì‘í•˜ê³ , #ì¢…ë£Œë¡œ ëª…ìƒì„ ì¢…ë£Œí•˜ëŠ” ê°„ë‹¨í•œ ì¸ì¦ ë°©ì‹ì…ë‹ˆë‹¤."
              type="info"
              showIcon
              style={{ marginTop: 16 }}
            />
          )}

          {challengeType === "weekly-planning" && (
            <Alert
              message="ìœ„í´ë¦¬ í”Œë˜ë‹ ì±Œë¦°ì§€"
              description="ë§¤ì£¼ ì£¼ê°„ ê³„íšì„ ì„ ì–¸í•˜ëŠ” ì±Œë¦°ì§€ì…ë‹ˆë‹¤. ê¸°ìƒì‹œê°„, ì·¨ì¹¨ì‹œê°„, í•µì‹¬ë¯¸ì…˜, ì´ë²ˆì£¼ ë‹¤ì§, ì›”ê°„ í”„ë¡œì íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤."
              type="info"
              showIcon
              style={{ marginTop: 16 }}
            />
          )}
        </Card>

        {/* ê¸°ë³¸ ì •ë³´ */}
        <Card title="ê¸°ë³¸ ì •ë³´" style={{ marginBottom: 24 }}>
          <Form.Item
            label="ì±Œë¦°ì§€ëª…"
            name="name"
            rules={[{ required: true, message: "ì±Œë¦°ì§€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" }]}
          >
            <Input placeholder="ì±Œë¦°ì§€ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
          </Form.Item>

          {(challengeType === "lifemastery" || challengeType === "lifemastery-club") && (
            <Form.Item
              label="ê¸°ìˆ˜"
              name="cardinal_number"
              rules={[{ required: true, message: "ê¸°ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" }]}
              help="ì˜ˆ: 1, 2, 3... (ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥) - í•„ìˆ˜ ì…ë ¥"
            >
              <InputNumber
                placeholder="ê¸°ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìˆ«ìë§Œ)"
                min={1}
                max={999}
                style={{ width: 200 }}
                addonAfter="ê¸°"
                precision={0}
              />
            </Form.Item>
          )}

          <Form.Item
            label="ê¸°ê°„"
            name="period"
            rules={[{ required: true, message: "ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”" }]}
          >
            <RangePicker style={{ width: "100%" }} />
          </Form.Item>

          <Form.Item label="ì„¤ëª…" name="description">
            <TextArea rows={4} placeholder="ì±Œë¦°ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
          </Form.Item>

          <Form.Item
            label="í™œì„± ìƒíƒœ"
            name="is_active"
            valuePropName="checked"
          >
            <Switch checkedChildren="í™œì„±" unCheckedChildren="ë¹„í™œì„±" />
          </Form.Item>
        </Card>

        {/* ë¼ì´í”„ë§ˆìŠ¤í„°ë¦¬ ì „ìš© ì„¤ì • */}
        {(challengeType === "lifemastery" || challengeType === "lifemastery-club") && (
          <>
            <Card title="â˜€ï¸ ì•„ì¹¨ ì¸ì¦ ì‹œê°„ ì„¤ì •" style={{ marginBottom: 24 }}>
              <Form.Item
                label="ì •ìƒ ì¸ì¦ ì‹œì‘ ì‹œê°„"
                name="morning_normal_start"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 05:00)"
              >
                <Input placeholder="ì˜ˆ: 05:00" style={{ width: 200 }} />
              </Form.Item>

              <Form.Item
                label="ì •ìƒ ì¸ì¦ ì¢…ë£Œ ì‹œê°„"
                name="morning_normal_end"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 10:00)"
              >
                <Input placeholder="ì˜ˆ: 10:00" style={{ width: 200 }} />
              </Form.Item>

              <Form.Item
                label="ì§€ê° ì¸ì¦ ì¢…ë£Œ ì‹œê°„"
                name="morning_late_end"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 11:00) - ì´ ì‹œê°„ê¹Œì§€ëŠ” ì§€ê°ìœ¼ë¡œ ì¸ì •"
              >
                <Input placeholder="ì˜ˆ: 11:00" style={{ width: 200 }} />
              </Form.Item>
            </Card>

            <Card title="ğŸŒ™ ë°ì¼ë¦¬ ì¸ì¦ ì‹œê°„ ì„¤ì •" style={{ marginBottom: 24 }}>
              <Form.Item
                label="ì •ìƒ ì¸ì¦ ì‹œì‘ ì‹œê°„"
                name="daily_normal_start"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 17:00)"
              >
                <Input placeholder="ì˜ˆ: 17:00" style={{ width: 200 }} />
              </Form.Item>

              <Form.Item
                label="ì •ìƒ ì¸ì¦ ì¢…ë£Œ ì‹œê°„"
                name="daily_normal_end"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 23:59)"
              >
                <Input placeholder="ì˜ˆ: 23:59" style={{ width: 200 }} />
              </Form.Item>

              <Form.Item
                label="ì§€ê° ì¸ì¦ ì¢…ë£Œ ì‹œê°„"
                name="daily_late_end"
                help="HH:mm í˜•ì‹ (ì˜ˆ: 01:00) - ìµì¼ ìƒˆë²½ê¹Œì§€ ì§€ê°ìœ¼ë¡œ ì¸ì •"
              >
                <Input placeholder="ì˜ˆ: 01:00" style={{ width: 200 }} />
              </Form.Item>
            </Card>

            <Card title="âš™ï¸ ì¸ì¦ ì •ì±… ì„¤ì •" style={{ marginBottom: 24 }}>
              <Form.Item
                label="ë¦¬ì…‹ë°© ê¸°ëŠ¥ í™œì„±í™”"
                name="demotion_enabled"
                valuePropName="checked"
                help="ë¦¬ì…‹ë°© ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ë©´ ì£¼ê°„ ìµœì†Œ ì¸ì¦ íšŸìˆ˜ ë¯¸ë‹¬ ì‹œ ë¦¬ì…‹ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤"
              >
                <Switch />
              </Form.Item>

              <Divider />

              <Form.Item
                label="ì£¼ê°„ ìµœì†Œ ì¸ì¦ íšŸìˆ˜"
                name="min_weekly_count"
                help="ì£¼ê°„ ìµœì†Œ ì¸ì¦ íšŸìˆ˜ ë¯¸ë§Œ ì‹œ ë¦¬ì…‹ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤ (ì•„ì¹¨+ë°ì¼ë¦¬ í•©ì‚°)"
              >
                <InputNumber
                  min={0}
                  max={14}
                  placeholder="4"
                  style={{ width: 200 }}
                  addonAfter="íšŒ"
                  precision={0}
                />
              </Form.Item>

              <Form.Item
                label="ë¶€í™œ ìµœì†Œ ì¸ì¦ íšŸìˆ˜ - ì•„ì¹¨"
                name="revival_min_morning_count"
                help="ë¦¬ì…‹ë°©ì—ì„œ ì£¼ê°„ ì•„ì¹¨ ì¸ì¦ íšŸìˆ˜"
              >
                <InputNumber
                  min={0}
                  max={7}
                  placeholder="3"
                  style={{ width: 200 }}
                  addonAfter="íšŒ"
                  precision={0}
                />
              </Form.Item>

              <Form.Item
                label="ë¶€í™œ ìµœì†Œ ì¸ì¦ íšŸìˆ˜ - ë°ì¼ë¦¬"
                name="revival_min_daily_count"
                help="ë¦¬ì…‹ë°©ì—ì„œ ì£¼ê°„ ë°ì¼ë¦¬ ì¸ì¦ íšŸìˆ˜"
              >
                <InputNumber
                  min={0}
                  max={7}
                  placeholder="3"
                  style={{ width: 200 }}
                  addonAfter="íšŒ"
                  precision={0}
                />
              </Form.Item>

              <Form.Item
                label="íœ´ì‹ë°© ê°•ë“± ê¸°ê°„"
                name="rest_period_weeks"
                help="ë¦¬ì…‹ë°©ì—ì„œ ì´ ê¸°ê°„ ë‚´ ë¯¸ë³µê·€ ì‹œ íœ´ì‹ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤"
              >
                <InputNumber
                  min={1}
                  max={4}
                  placeholder="2"
                  style={{ width: 200 }}
                  addonAfter="ì£¼"
                  precision={0}
                />
              </Form.Item>
            </Card>
          </>
        )}

        {/* ëª…ìƒ ë°”ë””ë”ë¸”ë§ ì „ìš© ì„¤ì • */}
        {challengeType === "meditation" && (
          <Card title="ğŸ§˜ ëª…ìƒ ë°”ë””ë”ë¸”ë§ ì„¤ì •" style={{ marginBottom: 24 }}>
            <Alert
              message="ì¸ì¦ ë°©ë²•"
              description={
                <div>
                  <p>â€¢ <strong>#ì‹œì‘</strong>: ëª…ìƒì„ ì‹œì‘í•  ë•Œ ì…ë ¥í•©ë‹ˆë‹¤</p>
                  <p>â€¢ <strong>#ì¢…ë£Œ</strong>: ëª…ìƒì„ ì¢…ë£Œí•  ë•Œ ì…ë ¥í•©ë‹ˆë‹¤</p>
                  <p style={{ marginBottom: 0 }}>â€¢ ì‹œì‘ê³¼ ì¢…ë£Œ ì‚¬ì´ì˜ ì‹œê°„ì´ ìë™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤</p>
                </div>
              }
              type="info"
              showIcon
              style={{ marginBottom: 16 }}
            />

            <Divider>ëª…ìƒ ê¸°ë³¸ ì„¤ì •</Divider>

            <Form.Item
              label="ì¼ì¼ ëª©í‘œ ëª…ìƒ ì‹œê°„ (ë¶„)"
              name="daily_goal_minutes"
              help="í•˜ë£¨ ëª©í‘œ ëª…ìƒ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤"
            >
              <InputNumber
                min={0}
                placeholder="20"
                style={{ width: 200 }}
                addonAfter="ë¶„"
                precision={0}
              />
            </Form.Item>

            <Form.Item
              label="ìµœì†Œ ëª…ìƒ ì‹œê°„ (ë¶„)"
              name="min_meditation_minutes"
              help="ì´ ì‹œê°„ ì´ìƒ ëª…ìƒí•´ì•¼ ì¸ì¦ìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤"
            >
              <InputNumber
                min={1}
                placeholder="5"
                style={{ width: 200 }}
                addonAfter="ë¶„"
                precision={0}
              />
            </Form.Item>

            <Divider>ë©”ì‹œì§€ í…œí”Œë¦¿</Divider>

            <Form.Item
              label="#ì‹œì‘ ë©”ì‹œì§€"
              name="start_message"
              help="ì‚¬ìš©ìê°€ #ì‹œì‘ì„ ì…ë ¥í–ˆì„ ë•Œ ìë™ìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€"
            >
              <TextArea
                rows={3}
                placeholder="ëª…ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ§˜â€â™€ï¸"
              />
            </Form.Item>

            <Form.Item
              label="#ì¢…ë£Œ ë©”ì‹œì§€"
              name="end_message"
              help="ì‚¬ìš©ìê°€ #ì¢…ë£Œë¥¼ ì…ë ¥í–ˆì„ ë•Œ ìë™ìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€"
            >
              <TextArea
                rows={3}
                placeholder="ëª…ìƒì„ ì¢…ë£Œí•©ë‹ˆë‹¤ âœ¨ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!"
              />
            </Form.Item>
          </Card>
        )}

        {/* ìœ„í´ë¦¬ í”Œë˜ë‹ ì „ìš© ì„¤ì • */}
        {challengeType === "weekly-planning" && (
          <Card title="ğŸ“… ìœ„í´ë¦¬ í”Œë˜ë‹ ì„¤ì •" style={{ marginBottom: 24 }}>
            <Alert
              message="ì„ ì–¸ ì–‘ì‹"
              description={
                <div>
                  <p>â€¢ <strong>ê¸°ìƒì‹œê°„</strong>: ë§¤ì¼ ëª©í‘œ ê¸°ìƒì‹œê°„</p>
                  <p>â€¢ <strong>ì·¨ì¹¨ì‹œê°„</strong>: ë§¤ì¼ ëª©í‘œ ì·¨ì¹¨ì‹œê°„</p>
                  <p>â€¢ <strong>í•µì‹¬ë¯¸ì…˜</strong>: ì´ë²ˆ ì£¼ í•µì‹¬ ë¯¸ì…˜</p>
                  <p>â€¢ <strong>ì´ë²ˆì£¼ ë‹¤ì§</strong>: ì£¼ê°„ ë‹¤ì§ í•œë§ˆë””</p>
                  <p style={{ marginBottom: 0 }}>â€¢ <strong>Nì›” í”„ë¡œì íŠ¸</strong>: ì›”ê°„ í”„ë¡œì íŠ¸ ëª©í‘œ</p>
                </div>
              }
              type="info"
              showIcon
              style={{ marginBottom: 16 }}
            />

            <Divider>ì„ ì–¸ ë§ˆê° ì„¤ì •</Divider>

            <Form.Item
              label="ì„ ì–¸ ë§ˆê° ìš”ì¼"
              name="declaration_deadline_day"
              help="ë§¤ì£¼ ì´ ìš”ì¼ê¹Œì§€ ì„ ì–¸ì„ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤"
            >
              <Radio.Group>
                <Radio value="sun">ì¼ìš”ì¼</Radio>
                <Radio value="mon">ì›”ìš”ì¼</Radio>
              </Radio.Group>
            </Form.Item>

            <Form.Item
              label="ì„ ì–¸ ë§ˆê° ì‹œê°„"
              name="declaration_deadline_time"
              help="ë§ˆê° ìš”ì¼ì˜ ëª‡ ì‹œê¹Œì§€ ì„ ì–¸í•´ì•¼ í•˜ëŠ”ì§€ ì„¤ì •í•©ë‹ˆë‹¤"
            >
              <InputNumber
                min={0}
                max={23}
                placeholder="23"
                style={{ width: 200 }}
                addonAfter="ì‹œ"
                precision={0}
              />
            </Form.Item>

            <Form.Item
              label="ì„ ì–¸ í•„ìˆ˜ ì—¬ë¶€"
              name="declaration_required"
              valuePropName="checked"
              help="í•„ìˆ˜ ì„ íƒ ì‹œ ë¯¸ì„ ì–¸ìëŠ” ë³„ë„ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤"
            >
              <Switch checkedChildren="í•„ìˆ˜" unCheckedChildren="ì„ íƒ" />
            </Form.Item>
          </Card>
        )}

        {/* ë””ìŠ¤ì½”ë“œ ì„¤ì • */}
        <Card title="ë””ìŠ¤ì½”ë“œ ì„¤ì •" style={{ marginBottom: 24 }}>
          <Form.Item
            label="ì±Œë¦°ì§€ ì¹´í…Œê³ ë¦¬"
            name="category_id"
            help="ì±Œë¦°ì§€ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš” (ì„ íƒì‚¬í•­)"
          >
            <Select
              placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”"
              options={challengeCategories.map((cat: any) => ({
                label: cat.name || cat.id,
                value: cat.id,
              }))}
              allowClear
            />
          </Form.Item>

          <Divider />

          <Alert
            message="Discord ì„¤ì •"
            description="ë¨¼ì € ê¸¸ë“œ(ì„œë²„)ë¥¼ ì„ íƒí•œ í›„ í•´ë‹¹ ê¸¸ë“œì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            type="info"
            showIcon
            style={{ marginBottom: 16 }}
          />

          <Form.Item label="Discord ê¸¸ë“œ (ì„œë²„)">
            <Select
              placeholder="ê¸¸ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”"
              onChange={handleGuildChange}
              value={selectedGuildId}
              options={guilds.map((guild) => ({
                label: `${guild.name} (ë©¤ë²„: ${guild.member_count}ëª…)`,
                value: guild.id,
              }))}
              allowClear
            />
          </Form.Item>

          <Form.Item
            label="Discord ì¹´í…Œê³ ë¦¬ ID"
            name="discord_category_id"
            help="Discord ì¹´í…Œê³ ë¦¬ ID (ì„ íƒì‚¬í•­)"
          >
            <Select
              placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”"
              disabled={!selectedGuildId}
              options={categories.map((category) => ({
                label: category.name,
                value: category.id,
              }))}
            />
          </Form.Item>

          <Form.Item
            label="ë””ìŠ¤ì½”ë“œ ì±„ë„ ID"
            name="channel_id"
            help="íŠ¹ì • ì±„ë„ IDë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë¹„ì›Œë‘ì„¸ìš”"
          >
            <Input placeholder="ë””ìŠ¤ì½”ë“œ ì±„ë„ IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)" />
          </Form.Item>

          <Form.Item
            label="ë””ìŠ¤ì½”ë“œ ì—­í•  ID"
            name="role_id"
            help="ì´ ì±Œë¦°ì§€ì™€ ì—°ê²°í•  ì—­í•  ID (ì„ íƒì‚¬í•­)"
          >
            <Input placeholder="ë””ìŠ¤ì½”ë“œ ì—­í•  IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)" />
          </Form.Item>
        </Card>
      </Form>
    </Create>
  );
};
